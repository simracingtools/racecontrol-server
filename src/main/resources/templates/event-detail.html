<!--
  #%L
  racecontrol-server
  %%
  Copyright (C) 2020 bausdorf engineering
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/gpl-3.0.html>.
  #L%
  -->

<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="index :: head"></head>
<body>
    <div class="container" style="max-width: 1600px;">
        <header th:replace="index :: header"></header>
        <div th:replace="index :: messages"></div>
        <div th:replace="index :: menu(title=${event.title})"></div>

        <div class="row" style="margin: 0;">
            <div class="col" style="padding: 0;">
                <div class="row" style="margin: 0;">
                    <input type="hidden" id="irLeagueID" th:value="${event.irLeagueID}">
                    <div class="col-3 col-sm-2 col-md-1 col-lg-1 col-xl-1" style="padding: 0;">
                        <picture class="float-right">
                            <img width="100px" th:src="${event.logoUrl}"/>
                        </picture>
                    </div>
                    <div class="col">
                        <p>
                            <span th:text="${#temporals.format(event.startDate, 'dd.MM.yyyy')}">12.11.2022</span>
                            <span>  -  </span>
                            <span th:text="${#temporals.format(event.endDate, 'dd.MM.yyyy')}">18.12.2022</span>
                        </p>
                        <p style="font-size: 14px;margin-bottom: 2px;" th:text="${event.description}">4th running of the most iconic Winter event. Broadcasted by racespotTV.</p>
                        <span style="font-size: 12px;">iRacing League </span>
                        <a th:href="'https://members.iracing.com/membersite/member/LeagueView.do?league=' + ${event.irLeagueID}" target="_blank" style="font-size: 12px;" th:text="${event.irLeagueName}">Winter 24h of the Nürburgring</a>
                    </div>
                    <div class="col-sm-12 col-md-4 col-lg-6 col-xl-4">
                        <div class="row">
                            <div class="col-sm-10 col-xl-12">
                                <span>Registration open</span>
                                <button th:if="${event.isRegistrationOpen()}" class= "btn btn-primary float-right" type="button" style="padding: 3px;padding-right: 6px;padding-left: 6px;margin-bottom: 3px;font-size: 10px;" th:data-target="${'#register-modal-' + event.eventId}" data-toggle="modal">Register</button>
                                <button th:if="${!event.isRegistrationOpen()}" class= "btn btn-secondary float-right" type="button" style="padding: 3px;padding-right: 6px;padding-left: 6px;margin-bottom: 3px;font-size: 10px;">Register</button>
                                <div th:replace="action-modals.html :: register-modal(${event}, ${teamRegistrationSelectView})"></div>
                            </div>
                        </div>
                        <div class="row" style="font-size: 14px;">
                            <div class="col-1 col-sm-1 col-md-2 col-lg-2 col-xl-2"><span>from</span></div>
                            <div class="col-6 col-sm-5 col-md-10 col-lg-5 col-xl-5">
                                <span id="regOpensTime" class="offset-time" th:text="${#temporals.format(event.registrationOpens, 'dd.MM.yyyy HH:mm ') + event.registrationOpensTZ}">12.04.</span>
                                <span id="regOpensLocal"></span>
                            </div>
                            <div class="col-4 col-sm-4 col-lg-5 col-xl-5">
                                <span id="regOpensCountdown"></span>
                            </div>
                        </div>
                        <div class="row" style="font-size: 14px;">
                            <div class="col-1 col-sm-1 col-md-2 col-lg-2 col-xl-2"><span>until</span></div>
                            <div class="col-6 col-sm-5 col-md-10 col-lg-5 col-xl-5">
                                <span id="regClosesTime" class="offset-time" th:text="${#temporals.format(event.registrationCloses, 'dd.MM.yyyy HH:mm ') + event.registrationClosesTZ}">22.09.2022 00:00 CEST</span>
                                <span id="regClosesLocal"></span>
                            </div>
                            <div class="col-4 col-sm-4 col-lg-5 col-xl-5">
                                <span id="regClosesCountdown"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin: 0;">
                    <div class="col">
                        <div style="font-size: 14px;">
                            <ul class="nav nav-tabs" role="tablist">
                                <li id="nav-tasks" class="nav-item" role="presentation">
                                    <a th:class="'nav-link' + ${(navigation == 'tasks' || navigation.isEmpty()) ? ' active' : ''}" role="tab" data-toggle="tab" href="#tab-tasks">Tasks</a>
                                </li>
                                <li id="nav-bop" class="nav-item" role="presentation">
                                    <a th:class="'nav-link' + ${navigation == 'bop' ? ' active' : ''}" role="tab" data-toggle="tab" href="#tab-bop">BOP</a>
                                </li>
                                <li id="nav-docs" th:if="${user.racedirection}" class="nav-item" role="presentation">
                                    <a th:class="'nav-link' + ${navigation == 'docs' ? ' active' : ''}" role="tab" data-toggle="tab" href="#tab-docs">Documents</a>
                                </li>
                                <li id="nav-teams" th:if="${!user.racedirection}" class="nav-item" role="presentation">
                                    <a th:class="'nav-link' + ${navigation == 'teams' ? ' active' : ''}" role="tab" data-toggle="tab" href="#tab-teams">My teams</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div id="tab-tasks" th:class="'tab-pane' + ${(navigation == 'tasks' || navigation.isEmpty()) ? ' active' : ''}" role="tabpanel">
                                    <div th:if="${!currentPerson.name.isEmpty()}" class="table-responsive" style="overflow: auto; max-height: 40em;">
                                        <div class="row">
                                            <div class="col">
                                                <label class="switch">
                                                    <input id="filterCompletedCheck" class="form-check-input" type="checkbox" onchange="hideCompletedTasks();"/>
                                                    <span class="slider round"></span>
                                                </label>
                                                <label class="form-check-label d-inline" for="filterCompletedCheck" style="vertical-align: text-bottom;">Only active</label>
                                                <button th:if="${user.getRacecontrol()}" class="btn btn-primary d-inline" type="button" style="padding: 1px 2px;font-size: 14px;margin-left: 1em;" data-target="#request-paint-modal" data-toggle="modal">Request Paints</button>                                            </div>
                                        </div>
                                        <table class="table" style="font-size: 14px;">
                                            <thead>
                                                <tr>
                                                    <th style="padding: 3px;">State</th>
                                                    <th style="padding: 3px;">created</th>
                                                    <th style="padding: 3px;">last change</th>
                                                    <th style="padding: 3px;">Possible Actions</th>
                                                    <th style="padding: 3px;"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="task-table">
                                                <tr th:each="action : ${actions}" th:id="'action-tr-' + ${action.id}" th:class="${action.targetState != null ? 'task-completed' : ''}">
                                                    <td th:style="'padding: 3px; ' + ${action.sourceState.getColorStyleString()}">
                                                        <input type="hidden" th:value="${action.id}" id="id">
                                                        <input type="hidden" th:value="${action.editActionMessage}" id="editActionMessage">
                                                        <input type="hidden" th:value="${action.workflowItemId}" id="workflowItemId">
                                                        <input type="hidden" th:value="${action.workflowName}" id="workflowName">
                                                        <span th:text="${action.sourceState.description}">Team Registration</span>
                                                        <div>
                                                            <span th:text="${action.teamName}">PCF Racing Red</span>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 3px;">
                                                        <span th:text="${#temporals.format(action.created, 'dd.MM.yyyy HH:mm')}">14.04.2022 16:59</span>
                                                        <div>
                                                            <span th:text="${' by ' + action.createdBy.name}">by John Doe</span>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 3px;">
                                                        <span th:text="${action.targetState != null ? #temporals.format(action.doneAt, 'dd.MM.yyyy HH:mm') : ''}">14.04.2022 17:18</span>
                                                        <div>
                                                            <span th:text="${action.targetState != null ? ('by ' + action.doneBy.name) : ''}">by Robert Bausdorf</span>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 3px;">
                                                        <div th:if="${action.targetState == null}" class="d-block" th:each="state: ${action.targetStates}">
                                                            <span th:style="${state.getColorStyleString()}" th:text="${state.description}">Assign car no</span>
                                                        </div>
                                                        <span class="d-block" th:if="${action.targetState != null}" th:text="${action.targetState.description}" th:style="${action.targetState.getColorStyleString()}">Assign car no</span>
                                                        <span class="d-block" th:if="${action.targetState != null}" th:text="${action.message}"></span>
                                                    </td>
                                                    <td class="text-center" style="padding: 3px;" th:if="${!action.targetStates.isEmpty()}">
                                                        <button th:if="${!action.sourceState.inActive && action.targetState == null}" th:disabled="${!action.executableByUser && !user.getRacecontrol()}" class="btn btn-primary" type="button" th:onclick="'editWorkflowAction(' + ${action.id} + ');'" style="padding-top: 3px;padding-bottom: 3px;padding-right: 10px;padding-left: 12px;" data-toggle="tooltip" th:title="${!action.executableByUser ? 'Only team owner is allowed to take action' : ''}">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <div th:if="${!action.sourceState.inActive && action.targetState == null}" th:replace="action-modals.html :: ${action.workflowName +  '-' + action.sourceState.stateKey + '-modal'}(${action}, '/team-registration-action', ${editAction})"></div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div th:if="${currentPerson.name.isEmpty()}" class="text-center" style="margin-top: 5em;">
                                        <p>You currently have no team registered, and you are not a member of an existing team.</p>
                                        <p>When either one of this becomes true you'll find your todo's here.</p>
                                        <button th:if="${event.isRegistrationOpen()}" class= "btn btn-primary" type="button" style="margin-top: 1em;" th:data-target="${'#register-modal-' + event.eventId}" data-toggle="modal">Register</button>
                                        <button th:if="${!event.isRegistrationOpen()}" class= "btn btn-secondary" type="button" style="margin-top: 1em;">Register</button>
                                    </div>
                                </div>
                                <div id="tab-bop" th:class="'tab-pane' + ${navigation == 'bop' ? ' active' : ''}" role="tabpanel">
                                    <div class="table-responsive">
                                        <table id="bop-table" class="table">
                                            <thead>
                                            <tr>
                                                <th style="font-size: 14px;">Car</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Effective fuel</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Fuel %</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Effective Weight (kg)</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Weight penalty (kg)</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Effective power (hp)</th>
                                                <th class="text-center" style="width: 9em; font-size: 14px;">Engine power adj (%)</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr th:each="bopView, bopViewStats : ${bopViews}">
                                                <td th:if="${user.racedirection}" style="font-size: 14px; cursor: pointer;" th:id="'carName-' + ${bopView.carView.id}" th:text="${bopView.carView.carName}" th:onclick="'editBop(' + ${bopView.carView.id} + ', ' + ${bopView.carView.carId} + ', ' + ${bopView.carView.carClassId} + ');'">Porsche 911 GT3 Cup (992)</td>
                                                <td th:if="${!user.racedirection}" style="font-size: 14px;" th:id="'carName-' + ${bopView.carView.id}" th:text="${bopView.carView.carName}">Porsche 911 GT3 Cup (992)</td>
                                                <td class="text-center" style="width: 9em; font-size: 14px;" th:id="'maxFuel-' + ${bopView.carView.id}" th:text="${bopView.getBopFuel()}">100</td>
                                                <td class="text-center" style="width: 9em; font-size: 14px;" th:id="'fuelPercent-' + ${bopView.carView.id}" th:text="${bopView.carView.fuelPercent}">100</td>
                                                <td class="text-center" style="width: 9em; font-size: 14px;" th:text="${bopView.getBopWeight()}">100</td>
                                                <td class="text-center" style="width: 9em; font-size: 14px;" th:id="'weightPenalty-' + ${bopView.carView.id}" th:text="${bopView.carView.weightPenalty}">0</td>
                                                <td class="text-center" style="width: 9em; font-size: 14px;" th:text="${bopView.getBopPower()}">100</td>
                                                <td class="text-center" style="width: 9em;">
                                                    <span style="font-size: 14px;" th:id="'enginePowerPercent-' + ${bopView.carView.id}" th:text="${bopView.carView.enginePowerPercent}">0</span>
                                                    <div th:id="'bop-modal-' + ${bopView.carView.id}" class="modal fade" role="dialog" tabindex="-1">
                                                        <div class="modal-dialog" role="document" style="max-width: 600px;">
                                                            <div class="modal-content">
                                                                <form method="post" th:action="@{/save-bop}" th:object="${bopEditView}">
                                                                    <div class="modal-header">
                                                                        <h4 class="modal-title">BOP Adjustment</h4><button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="row">
                                                                            <div class="col">
                                                                                <h5 th:text="${bopView.carView.carName}">BMW M4 GT3</h5>
                                                                            </div>
                                                                        </div>                                                                        <div class="row">
                                                                            <div class="col">
                                                                                <input type="hidden" th:field="*{id}">
                                                                                <input type="hidden" th:field="*{carName}">
                                                                                <input type="hidden" th:field="*{carId}">
                                                                                <input type="hidden" th:field="*{carClassId}">
                                                                                <input type="hidden" th:field="*{eventId}">
                                                                                <h5 th:text="*{carName}">BMW M4 GT3</h5>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col">
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">max Fuel</label>
                                                                                    <input th:field="*{maxFuel}" type="number" min="0.0" step="1" style="width: 4em;"/>
                                                                                    <span id="effectiveFuel" style="margin-left: 1em;" th:text="${'(' + bopView.getBopFuel() + ')'}">(99.6)</span>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">Weight</label>
                                                                                    <input id="weight" th:value="${bopView.weight}" type="number" min="0.0" step="1" placeholder="2000" style="width: 4em;" readonly/>
                                                                                    <span id="effectiveWeight" style="margin-left: 1em;" th:text="${'(' + bopView.getBopWeight() + ')'}">(99.6)</span>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">HP</label>
                                                                                    <input id="horsePower" th:value="${bopView.horsePower}" type="number" min="0.0" step="1" placeholder="2000" style="width: 4em;" readonly/>
                                                                                    <span id="effectivePower" style="margin-left: 1em;" th:text="${'(' + bopView.getBopPower() + ')'}">(99.6)</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col">
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">Fuel %</label>
                                                                                    <input th:field="*{fuelPercent}" type="number" min="0.0" max="100.0" step="0.1" placeholder="100.0" style="width: 4em;" th:onchange="'calcEffectiveFuel(' + ${bopView.carView.id} + ');'"/>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">Penalty</label>
                                                                                    <input th:field="*{weightPenalty}" type="number" min="0.0" max="100.0" step="0.1" placeholder="100.0" style="width: 4em;" th:onchange="'calcWeight(' + ${bopView.carView.id} + ');'"/>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label style="width: 5em;">HP adj %</label>
                                                                                    <input th:field="*{enginePowerPercent}" type="number" th:min="${bopView.minPowerAdjustPct}" th:max="${bopView.maxPowerAdjustPct}" step="0.1" style="width: 4em;" th:onchange="'calcPower(' + ${bopView.carView.id} + ');'"/>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button class="btn btn-light" type="button" data-dismiss="modal">Close</button>
                                                                        <button class="btn btn-primary" type="submit">Save</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div th:if="${user.racedirection}" id="tab-docs" th:class="'tab-pane' + ${navigation == 'docs' ? ' active' : ''}" role="tabpanel">
                                    <p>Content for tab 7.</p>
                                </div>
                                <div th:if="${!user.racedirection}" id="tab-teams" th:class="'tab-pane' + ${navigation == 'teams' ? ' active' : ''}" role="tabpanel">
                                    <div th:each="team: ${event.userRegistrations}" th:if="${!team.workflowState.inActive}" th:id="'team-row-' + ${team.id}" class="row" style="border-radius: 5px;border: 2px solid rgb(70,149,225); margin-bottom: 2px;">
                                        <div class="col">
                                            <div class="row">
                                                <div class="col">
                                                    <h4 th:text="${team.getFullTeamNameWithNumber() + ' (' + team.carClass.name + ')'}">#89 C3 Racing Green</h4>
                                                    <h5 th:text="${team.car.carName}">team car name</h5>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div style="margin-top: 1em;">
                                                        <h6>Registered at</h6>
                                                        <div class="d-block">
                                                            <span th:text="${#temporals.format(team.created, 'dd.MM.yyyy HH:mm')}">unknown</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div style="margin-top: 1em;">
                                                        <h6>Team owner</h6>
                                                        <div class="d-block">
                                                            <span th:text="${team.createdBy.name}">Unknown</span>
                                                            <button class="btn btn-primary float-right" type="button" style="padding: 0 3px;" th:disabled="${user.getIRacingId != team.createdBy.iracingId}" th:onclick="'changeTeamOwner(' + ${team.id} + ');'">
                                                                <i class="fas fa-edit" data-toggle="tooltip" th:title="${user.getIRacingId != team.createdBy.iracingId ? 'Only team owner is allowed to take action' : 'Transfer team ownership'}"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div th:replace="action-modals.html :: change-owner-model(${event.eventId}, ${team}, '/change-team-owner')"></div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div style="margin-top: 1em;">
                                                        <h6>Current Status</h6>
                                                        <div class="d-block">
                                                            <span th:text="${team.workflowState.description}" th:style="${team.getColorStyleString()}">Payment received, registration confirmed</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div style="margin-top: 1em;">
                                                        <h6>Team Permit Time</h6>
                                                        <div class="d-block">
                                                            <span th:text="${team.teamPermitTime}" th:class="${team.teamPermitTime.equalsIgnoreCase('NONE') ? 'text-danger' : 'text-success'}">NONE</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div style="margin-top: 2em;">
                                                        <form method="post" th:object="${editAction}" th:action="@{/team-registration-action}">
                                                            <input type="hidden" th:field="*{id}">
                                                            <input type="hidden" th:field="*{eventId}">
                                                            <input type="hidden" name="workflowItemId" th:value="${team.id}">
                                                            <div th:id="'teamActionSelect-' + ${team.id}" class="input-group">
                                                                <div class="input-group-prepend">
                                                                    <span class="input-group-text">Action</span>
                                                                </div>
                                                                <select th:field="*{targetStateKey}" th:oninput="'changeTeamActionSelectDisplay(' + ${team.id} + ');'">
                                                                    <option value="" style="background-color: #FFFFFF; color: #000000;">Select Action</option>
                                                                    <option th:each="state: ${team.workflowState.followUps}" th:if="${state.dutyRoles.contains(currentPerson.role)}" th:value="${state.stateKey}" th:text="'Proceed to ' + ${state.description}" th:style="${state.getColorStyleString()}"></option>
                                                                </select>
                                                                <div class="input-group-append">
                                                                    <button class="btn btn-primary" type="submit" th:disabled="${user.getIRacingId != team.createdBy.iracingId}" data-toggle="tooltip" th:title="${user.getIRacingId != team.createdBy.iracingId ? 'Only team owner is allowed to take action' : ''}">
                                                                        <i class="far fa-caret-square-right"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <label>Team Members</label>
                                            <button class="btn btn-primary" type="button" style="margin-left: 1em;" th:onclick="'checkTeamMemberStatus(' + ${team.id} + ');'">
                                                <i th:id="'check-team-icon-' + ${team.id}" class="far fa-question-circle" data-toggle="tooltip" title="Re-Check status of all team members"></i>
                                                <span th:id="'check-team-spinner-' + ${team.id}" style="display: none;" class="spinner-border spinner-border-sm" role="status"></span>
                                            </button>
                                            <button class="btn btn-primary float-right" type="button" th:onclick="'addTeamMember(' + ${team.id} + ', ' + ${team.iracingId} + ');'" th:disabled="${user.getIRacingId != team.createdBy.iracingId}">
                                                <i class="fas fa-plus" data-toggle="tooltip" title="Add person"></i>
                                            </button>
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <caption style="padding: 4px; font-size: 14px;" th:if="${team.getDriverCount() < event.minTeamDrivers}" class="font-weight-bold table-warning" th:text="'A minimum of ' + ${event.minTeamDrivers} + ' drivers is required'"></caption>
                                                    <caption style="padding: 4px; font-size: 14px;" th:if="${team.getDriverCount() > event.maxTeamDrivers}" class="font-weight-bold table-warning" th:text="'A maximum of ' + ${event.maxTeamDrivers} + ' drivers is allowed'"></caption>
                                                    <caption style="padding: 4px; font-size: 14px;" th:if="${team.getDriversNotInLeagueCount() > 0}" class="font-weight-bold table-warning" th:text="${team.getDriversNotInLeagueCount()} + ' drivers are not league members'"></caption>
                                                    <caption style="padding: 4px; font-size: 14px;" th:if="${team.getDriversNotRegisteredCount() > 0}" class="font-weight-bold table-info" th:text="${team.getDriversNotRegisteredCount()} + ' drivers are not registered here'"></caption>
                                                    <thead>
                                                    <tr>
                                                        <th style="width: 7em;padding: 3px;">Name</th>
                                                        <th style="padding: 3px;"></th>
                                                        <th style="padding: 3px;">Role</th>
                                                        <th style="padding: 3px;">Permit</th>
                                                        <th style="width: 3em;padding: 3px;"></th>
                                                    </tr>
                                                    </thead>
                                                    <tbody style="font-size: 12px; padding: 2px;">
                                                    <tr th:each="person, personStat: ${team.teamMembers}">
                                                        <td style="cursor: pointer;" th:text="${person.name}" th:onclick="'editTeamMember(' + ${personStat.index} + ', ' + ${team.id} + ');'">Robert Bausdorf</td>
                                                        <td th:if="${person.registered && person.leagueMember}" th:class="'text-center table-icon ' + ${person.iracingTeamChecked ? 'table-success' : 'table-danger'}">
                                                            <i class="far fa-check-circle text-success" title="League member and registered here" data-toggle="tooltip"></i>
                                                        </td>
                                                        <td th:if="${!person.registered && person.leagueMember}" th:class="'text-center table-icon ' + ${person.iracingTeamChecked ? 'table-success' : 'table-warning'}">
                                                            <i class="far fa-check-circle text-info" title="League member but not registered here" data-toggle="tooltip"></i>
                                                        </td>
                                                        <td th:if="${person.registered && !person.leagueMember}" th:class="'text-center table-icon ' + ${person.iracingTeamChecked ? 'table-success' : 'table-info'}">
                                                            <i class="far fa-check-circle text-warning" title="No league member but registered here" data-toggle="tooltip"></i>
                                                        </td>
                                                        <td th:if="${!person.registered && !person.leagueMember && person.iracingChecked}" th:class="'text-center table-icon ' + ${person.iracingTeamChecked ? 'table-success' : 'table-info'}">
                                                            <i class="far fa-question-circle text-danger" data-toggle="tootltip" title="Checked iRacing Id but no league member and not registered here"></i>
                                                        </td>
                                                        <td th:if="${!person.registered && !person.leagueMember && !person.iracingChecked}" class="text-center table-danger table-icon">
                                                            <i class="far fa-question-circle text-danger" data-toggle="tootltip" title="Unchecked iRacing Id"></i>
                                                        </td>
                                                        <td style="font-size: 12px;" th:text="${person.role}" th:class="${person.iracingTeamChecked ? 'text-success' : 'text-danger'}" data-toggle="tooltip" th:title="${person.iracingTeamChecked ? 'Is member of iRacing team' : 'Has to be added to iRacing team'}">RACE DIRECTOR</td>
                                                        <td style="font-size: 12px;" th:text="${person.permitTime}" th:class="${!person.permitTime.equalsIgnoreCase('NONE') ? 'text-success' : 'text-danger'}">NONE</td>
                                                        <td style="padding: 2px;">
                                                            <button class="btn btn-danger" type="button" th:onclick="'confirmMemberRemove(' + ${person.id} + ', ' + ${team.id} + ');'" th:disabled="${user.getIRacingId != team.createdBy.iracingId}">
                                                                <i class="far fa-trash-alt"></i>
                                                            </button>
                                                            <div th:replace="index.html::deleteModal('staff-remove-confirm-' + ${person.id} + ${team.id}, 'Do you really want to remove ' + ${person.name} + ' from team ' + ${team.getFullTeamName()} + ' ?', @{/team-remove-member(personId=${person.id}, registrationId=${team.id})})"></div>
                                                        </td>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_id'" th:value="${person.id}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_iracingId'" th:value="${person.iracingId}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_eventId'" th:value="${person.eventId}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_name'" th:value="${person.name}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_role'" th:value="${person.role}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_registered'" th:value="${person.registered}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_leagueMember'" th:value="${person.leagueMember}"/>
                                                        <input type="hidden" th:id="'staff' + ${team.id} + '_' + ${personStat.index} + '_iracingChecked'" th:value="${person.iracingChecked}"/>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-5 col-xl-4" style="padding-right: 5px;padding-left: 5px;">
                        <h6>Current Registrations</h6>
                        <div style="font-size: 12px;">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item" role="presentation" th:each="carClass, carClassStat : ${teamRegistrations}">
                                    <a th:class="${'nav-link' + (activeCarClass.equalsIgnoreCase(carClass.name) ? ' active' : '')}" role="tab" data-toggle="tab" th:href="${'#tab-' + carClass.name}" style="padding: 2px;font-size: 14px;">
                                        <span th:text="${carClass.name}">SP9</span><span th:text="${' (' + carClass.availableSlots + '/' + carClass.maxSlots} + ')'"></span>
                                    </a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div th:each="carClass,carClassStat : ${teamRegistrations}" th:id="${'tab-' + carClass.name}" th:class="${'tab-pane' + (activeCarClass.equalsIgnoreCase(carClass.name) ? ' active' : '')}" role="tabpanel">
                                    <div class="table-responsive" style="font-size: 14px; overflow: auto; max-height: 40em;">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th style="padding: 3px;">car #</th>
                                                    <th style="padding: 3px;">Team</th>
                                                    <th style="padding: 3px;">Permit</th>
                                                    <th style="padding: 3px;"></th>
                                                    <th style="padding: 3px;">Car</th>
                                                </tr>
                                            </thead>
                                            <tbody style="padding: 3px;">
                                                <tr th:style="${'padding: 3px; ' + (regStat.index < carClass.maxSlots ? registration.getColorStyleString() : 'background-color: #d5d5d5')}" th:each="registration, regStat : ${carClass.registrations}">
                                                    <td class="text-right" style="padding: 3px; font-size: 14px;" th:text="${regStat.index < carClass.getMaxSlots() ? registration.assignedCarNumber : 'W ' + (regStat.index - carClass.maxSlots + 1)}">34</td>
                                                    <td style="padding: 3px;font-size: 14px; cursor: pointer;" th:text="${registration.getFullTeamName()}" th:onclick="'editRegisteredCar(' + ${registration.id} + ');'">Sikania Endurance Motosport TCR</td>
                                                    <td th:if="${registration.teamPermitTime != null}" th:class="${('NONE'.equals(registration.teamPermitTime) ? 'table-danger' : 'table-success') + ' text-center'}" style="padding: 3px; font-size: 14px;" th:text="${registration.teamPermitTime}">NONE</td>
                                                    <td th:if="${registration.teamPermitTime == null}" th:class="text-center" style="padding: 3px; font-size: 14px;" th:text="${registration.teamPermitTime}">NONE</td>
                                                    <td style="padding: 3px;font-size: 14px;">
                                                        <img th:if="${!registration.car.carLogoUrl.isEmpty()}" th:src="${registration.car.carLogoUrl}" width="20px" style="font-size: 12px;" />
                                                        <input type="hidden" th:id="'carId-' + ${registration.id}" th:value="${registration.car.id}">
                                                        <input type="hidden" th:id="'wildcard-' + ${registration.id}" th:value="${registration.wildcard}">
                                                        <div th:replace="action-modals.html :: car-modal(${carClass.name + ': ' + registration.getFullTeamNameWithNumber()}, '/edit-registered-car', ${registeredCarEditView})"></div>
                                                    </td>
                                                    <td style="padding: 3px;font-size: 14px;" th:text="${registration.car.carName}">Audi RS3 LMS</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-left: 0; margin-right: 0; margin-top: 1em;">
                    <div class="col">
                        <h5 class="d-inline">Event sessions</h5>
                        <a th:if="${user.racedirection}" th:href="@{/create-session(eventId=${event.eventId})}">
                            <button class="btn btn-primary" type="button" style="height: 25px;padding-top: 0;padding-bottom: 0;margin-top: 2px;margin-bottom: 2px;padding-right: 6px;padding-left: 6px;margin-left: 10px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </a>
                        <div class="table-responsive" style="font-size: 14px;">
                            <table class="table table-sm" id="session-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date</th>
                                        <th>Mode</th>
                                        <th>Duration</th>
                                        <th>Track</th>
                                        <th>Track Conditions</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="sessionView : ${event.trackSessions}">
                                        <td>
                                            <a th:if="${user.racedirection}" th:href="@{/create-session(eventId=${event.eventId}, sessionId=${sessionView.id})}">
                                                <span class="d-block" th:text="${sessionView.title}"></span>
                                            </a>
                                            <span class="d-block" th:if="${!user.racedirection}" th:text="${sessionView.title}"></span>
                                            <a th:if="${sessionView.irSessionId}" th:href="@{/session-result(eventId=${event.eventId}, irSessionId=${sessionView.irSessionId}, activeTab=${navigation})}">
                                                <span class="d-block">Results</span>
                                            </a>
                                        </td>
                                        <td>
                                            <span class="offset-time" th:text="${#temporals.format(sessionView.datetime, 'dd.MM.yyyy HH:mm Z')}"></span>
                                            <span></span>
                                        </td>
                                        <td>
                                            <table class="table table-sm">
                                                <tr th:each="subsession : ${sessionView.sessionParts}">
                                                    <td th:text="${subsession.sessionTypeName}" style="border: 0; padding: 1px;">Open Practice</td>
                                                    <td class="float-right" th:text="${subsession.durationString}" style="border: 0; padding: 1px;">00:40</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td th:text="${sessionView.getOverallDuration()}">02:00</td>
                                        <td>
                                            <span class="d-block" th:text="${sessionView.trackConfigView.track.name}">Nürburgring Combined</span>
                                            <span class="d-block" th:text="${sessionView.trackConfigView.configName}">Gesamtstrecke 24h</span>
                                        </td>
                                        <td>
                                            <span class="d-block" th:text="${#temporals.format(sessionView.simulatedTimeOfDay, 'dd.MM.yyyy HH:mm')}">30.11.2022 07:30</span>
                                            <span class="d-block" th:text="${sessionView.getTrackConditionInfo()}">Dynamic Weather, Track usage 5%</span>
                                        </td>
                                        <td class="float-right">
                                            <button th:if="${user.racedirection}" class="btn btn-danger" type="button">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:replace="action-modals.html :: staff-modal('Add team member', '/team-save-member', ${editStaffView})"></div>

        <div class="modal fade" role="dialog" tabindex="-1" id="team-upload-modal" >
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form id="upload-logo-form" method="post" th:action="@{/team-logo-upload}" enctype="multipart/form-data">
                        <div class="modal-header">
                            <h4 class="modal-title">Upload event logo</h4><button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Event logo file</label>
                                <input class="form-control-file" type="file" name="file"/>
                                <input class="form-control" type="hidden" name="eventId" th:value="${event.getEventId()}"/>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-light" type="button" data-dismiss="modal">Close</button>
                            <button class="btn btn-primary" type="submit">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="request-paint-modal" class="modal fade" role="dialog" tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="post" th:action="@{/request-paints}" th:object="${requestPaintsView}">
                        <div class="modal-header">
                            <h4 class="modal-title">Request paint</h4>
                            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" th:field="*{eventId}">
                            <div class="form-group">
                                <label>Confirmed teams</label>
                                <select class="form-control" multiple style="height: 15em;" th:field="*{selectedTeamIds}">
                                    <option th:each="team: ${requestPaintsView.getConfirmedTeams()}" th:value="${team.id}" th:text="${team.getFullTeamNameWithNumber()}">This is item 1</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-light" type="button" data-dismiss="modal">Close</button>
                            <button class="btn btn-primary" type="submit">Request paint</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div th:insert="index :: footer"></div>
    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/admin.js"></script>
    <script src="/webjars/momentjs/moment.js"></script>
    <script src="/webjars/momentjs/locale/de.js"></script>
    <script src="/webjars/jquery-ui/jquery-ui.js"></script>

    <script>
        $(document).ready(function () {
            var userLang = navigator.language || navigator.userLanguage;
            moment.locale(userLang.split('-')[0]);

            showLocalTime();
            initFilterCompletedCheck();
            setInterval(function() {
                registrationOpenCountdown();
                registrationClosedCountdown();
            }, 1000);

            $("#staff-modal #name").autocomplete({
                minLength : 2,
                appendTo: "#staff-modal",
                source : function(request, response) {
                    $('#search-spinner').show();
                    $.ajax({
                        url : "/rest/team-search/" + $('#staff-modal-form #teamIrId').val(),
                        dataType : "json",
                        data : {
                            q : request.term,
                            league : $("#irLeagueID").val()
                        },
                        success : function(data) {
                            response(data);
                        }
                    });
                },
                response: function(event, ui) {
                    $('#search-spinner').hide();
                },
                select: function(event, ui) {
                    personSelected(ui.item);
                }
            });
        });
    </script>
</body>

</html>